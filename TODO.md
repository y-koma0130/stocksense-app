# TODO

## Phase 1: 法的整備 + フィードバック基盤 ✅ 完了

### 法的ページの作成
- [x] LP (ランディングページ) の作成
- [x] 利用規約ページの作成
- [x] プライバシーポリシーページの作成
- [ ] お問い合わせページの作成 (スキップ)

### フッターの実装
- [x] フッターコンポーネントの作成
- [x] 法的ページへのリンク配置
- [x] レスポンシブ対応

### ユーザーフィードバック機能
- [x] GitHub Issues自動登録機能の実装
- [x] フィードバック送信UIの作成 (アカウントメニューに統合)
- [x] フィードバック送信APIの実装 (GitHub API連携)
- [x] フィードバック種別の追加 (バグ報告、機能リクエスト、UI改善、その他)

---

## Phase 2: 無料β版ユーザー獲得準備 (最優先)

### スコアリングロジックのリファクタリング ✅ 完了
- [x] 定数の集約 (marketTypes, periodTypes)
- [x] 値オブジェクトの整理 (indicatorScore, totalScore)
- [x] 集約エンティティの作成 (valueStockScore)
- [x] ドメインサービスの分割 (各スコア計算関数を個別ファイル化)
- [x] ユーティリティの共通化 (clamp関数)
- [x] 冗長なラッパーサービスの削除
- [x] ユースケースのリファクタリング
- [x] sector_averagesの最新データを使用するようJOIN条件を修正
- [x] スコアリングロジックの修正（0-100の範囲で適切にスコアが分散）

### 罠株判定のブラッシュアップ（Phase 3以降）
- [ ] **成長性指標の追加**
  - [ ] 売上高5年CAGR（Compound Annual Growth Rate）の計算
    - 0%未満: 大幅減点（縮小企業）
    - 0〜5%: 普通
    - 5%以上: プラス補正（成長企業）
  - [ ] データ取得: 過去5年分の売上高データが必要
- [ ] **利益安定性指標の追加**
  - [ ] 営業利益の変動係数（標準偏差/平均）の計算
    - 0.4以下: 安定企業、加点
    - 0.4〜1.0: 中立
    - 1.0以上: ハイリスク、減点
  - [ ] データ取得: 過去5年分の営業利益データが必要
- [ ] **時価総額フィルタの追加**
  - [ ] 時価総額による減点・除外ロジック
    - 300億以上: 安定
    - 100〜300億: 中立（少し減点）
    - 100億未満: 大幅減点（ボラティリティ高）
  - [ ] データ取得: 時価総額データが必要（発行済株式数 × 株価）
- [ ] **スコアリング重み調整**
  - [ ] 成長性・安定性・時価総額を組み込んだ新しい重み配分の検討
  - [ ] 中小型の不安定銘柄が下位になるよう調整
- [ ] **テスト・検証**
  - [ ] 過去の罠株（エアトリ、イーソル、マイネット等）が除外されるか検証
  - [ ] 優良バリュー株（アンビス、UPR、タカトリ等）が上位に残るか検証

### UI/UXのモバイル対応 ✅ 完了
- [x] ヘッダーのレスポンシブ対応
  - [x] モバイルでロゴをアイコンのみに切り替え
  - [x] 通知設定ボタンのサイズ調整
  - [x] スクロール時にヘッダーを自動非表示/表示
- [x] ドロワーのモバイル対応 (モバイルで100%幅表示)
- [x] ダッシュボードのレスポンシブ対応
- [x] マーケットサマリーのモバイル表示最適化
- [x] バリュー株ランキングのモバイル表示最適化
- [x] フッターのモバイル対応確認

### 通知メッセージの改善 ✅ 完了
- [x] LINE通知メッセージのフォーマット改善
  - [x] スコアを0-100に統一
  - [x] 上位3銘柄に詳細情報（PER/PBR業種比、RSI状態、価格位置）を追加
  - [x] 4位以降は簡略表示
  - [x] メダル絵文字で視覚的に改善
- [x] 銘柄情報の見やすさ向上
- [x] スコア表示の視覚的改善
- [x] ウェブ画面での銘柄名にYahoo Financeへの外部リンクを追加
- [x] デフォルト表示を中期（短期）に変更
- [x] ドロワー内の価格位置表示を期間に応じて動的に切り替え（26週/52週）

### マーケティング準備
- [ ] X (Twitter) 投稿用のスクリーンショット準備
- [ ] プロモーション文言の作成
- [ ] β版ユーザー募集開始

---

## Phase 3: コア機能拡張 (ユーザーフィードバック収集後)

### 権限・ロール基盤の整備
- [ ] `user_plan` カラムの追加 (Free/Premium enum)
- [ ] プラン情報を管理するテーブル設計
- [ ] マイグレーション作成
- [ ] ユーザープラン取得の共通関数
- [ ] Feature Flag システムの実装
- [ ] 使用制限チェック機能 (通知数、分析回数など)
- [ ] プラン別機能制限の定義

### マーケット動向取得
- [ ] 外部API選定 (Yahoo Finance, Alpha Vantage等)
- [ ] 日経平均・TOPIX データ取得
- [ ] セクター別指数データ取得
- [ ] データ取得のスケジューリング (Inngest)
- [ ] キャッシュ戦略の実装
- [ ] マーケット動向表示UIの改善

### ウォッチリスト機能
- [ ] ウォッチリストテーブルの設計
- [ ] 銘柄追加・削除API実装
- [ ] ウォッチリスト表示UIの作成
- [ ] ウォッチリスト銘柄の通知設定
- [ ] 最大登録数の制限 (Free: 10銘柄, Premium: 100銘柄など)

---

## Phase 4: ユーザー反応確認 & 改善イテレーション

### フィードバック収集
- [ ] ユーザーアンケートの実施
- [ ] 使用状況の分析
- [ ] 要望の優先度付け

### 機能改善
- [ ] フィードバックに基づくUI/UX改善
- [ ] バグ修正
- [ ] パフォーマンス最適化

---

## Phase 5: 課金機能実装 (反応が良ければ)

### 課金基盤
- [ ] Stripe連携
- [ ] サブスクリプションプランの実装
- [ ] 決済フローの実装
- [ ] 課金管理画面

### Premium機能の実装
- [ ] ウォッチリスト上限解除
- [ ] 通知フィルタリング機能
- [ ] 詳細分析レポート
- [ ] 優先サポート

---

## Phase 6: LLMマーケット分析 (コスト検証後)

### 基本的なマーケット分析
- [ ] LLM API (OpenAI/Anthropic) の選定とコスト検証
- [ ] 日経平均のトレンド分析
- [ ] セクター別トレンド分析
- [ ] マーケットセンチメント分析
- [ ] キャッシュ戦略の実装 (コスト削減)
- [ ] LLM使用量のモニタリング
- [ ] レート制限の実装

### 分析結果の表示
- [ ] マーケット分析ページの作成
- [ ] 分析結果のカード表示
- [ ] 更新頻度の表示 (1日1回など)

### Premium機能 (LLM)
- [ ] ユーザー指定銘柄のLLM深掘り分析
- [ ] カスタム分析プロンプトの実装

---

## 将来的なタスク (Phase 7以降)

### 通知フィルタリング
- [ ] 市場別フィルター (東証プライム、スタンダードなど)
- [ ] 業種別フィルター
- [ ] 価格帯フィルター
- [ ] スコア範囲フィルター
- [ ] フィルター設定画面の作成
- [ ] 保存した設定の管理
- [ ] フィルター設定の保存 (DB)
- [ ] フィルター適用ロジックの実装

### その他の機能拡張
- [ ] ポートフォリオ管理機能
- [ ] 銘柄比較機能
- [ ] アラート機能の拡張
- [ ] 管理画面 (ユーザープラン管理、使用状況ダッシュボード)

### UI/UX改善 (継続的)
- [ ] PER, PBR, ROE 等の指標説明ツールチップ
- [ ] スコアリングロジックの説明ページ
- [ ] 各指標の「良い値」「悪い値」の目安表示
- [ ] 初回ユーザー向けチュートリアル
- [ ] 機能紹介ツアー
- [ ] ヘルプ/FAQページ
